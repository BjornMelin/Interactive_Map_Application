---
title: "MAT213 Project #5"
author: "Bjorn Melin"
date: "4/23/2019"
runtime: shiny
output: html_document
---


```{r,echo=FALSE,message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(ggmap)
library(leaflet)
library(rgdal)
library(maps)
library(mapdata)
library(broom)
library(maptools)
library(leaflet.extras)
library(scales)
library(dplyr)
#library(plyr)
# When you use google to get place information, register your key.  
# (You need to be connected to the web.)
ggmap::register_google(key = "AIzaSyDwEoO3zb84PWYxp8_uK3z163Gkc4wLLKg")

# Reads in the trip history data from the 2017 season dataset
trip_hist_2017 <- read.csv(file = "Nice_ride_data_2017_season/Nice_ride_trip_history_2017_season.csv")

# Reads in the station data from the 2017 season dataset
station_locations_2017 <- read.csv(file = "Nice_ride_data_2017_season/Nice_Ride_2017_Station_Locations.csv")
```




```{r, echo=FALSE, message=FALSE}
# I need to create the map using the station_locations_2017 data
#glimpse(station_locations_2017)

# Makes a google map of the Minneapolis/St Paul area
msp_map <- get_map(location=c("Minneapolis/St Paul, Minnesota"),maptype = "roadmap",zoom=11)
#ggmap(msp_map)

# Creates a ggplot with points denoting the location of all bike stations
# in the Minneapolis area
station_plot <- ggplot() +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude)) +
  coord_fixed(ratio = 1.3)
#station_plot

#### Plot A ####
# Combines the map of Minneapolis generated and the plot of the bike stations
# in the Minneapolis area.  Used xlim and ylim to make the point more easy to
# differentiate.
station_map <- ggmap(msp_map) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75) +
  coord_fixed(ratio = 1.3, xlim = c(-93.4,-93.05), ylim = c(44.875,45.05)) +
  xlab(label = "Longitude") + 
  ylab(label = "Latitude") +
  ggtitle(label = "Nice Ride Bike Station Locations In MPLS/STP (2017)") +
  theme(axis.title = element_text(face = "bold", size = rel(1)),
        plot.title = element_text(size = rel(1.2), face = "bold", hjust = 0.5))
```



The app created for this project was constructed by using one of the maps for representing Nice Ride Bike Locations in project 4.  I imported a shapefile containing the neighborhood boundaries of Minneapolis from (http://opendata.minneapolismn.gov/datasets/communities) and a shapefile containing the neighborhood boundaries of Saint Paul from (https://information.stpaul.gov/City-Administration/District-Council-Shapefile-Map/dq4n-yj8b).  Then I created a new map which combined the Nice Ride map from project 4 with the neighborhood boundaries from the shapefiles.  The original map from prject 4 was modified so that in addition to showing points to represent all Nice Ride Station locations in the Minneapolis/St. Paul area, it would show borders on the map denoting the borders between neighborhoods in each city.  The app will include check boxes for each neighborhood which when selected, will display the neighborhoods boundary and the Nice Ride Stations in that neighborhood.


```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Reads in the shapefile of the neighborhood boundaries in Minneapolis 
NBHD_MPLS <- readOGR(dsn = "Communities", verbose = FALSE)

# Displays the variable names of the shapefile
#names(NBHD_boundary)

# Reads in the shapefile of the neighborhood boundaries in STP
NBHD_STP <- readOGR(dsn = "STP_Neighborhoods", verbose = FALSE)

# Used to check what the variables represented in the STP shapefile
# as.data.frame(NBHD_STP)
# names(NBHD_STP)

```


```{r, echo=FALSE,message=FALSE, warning=FALSE}
mpls_neighborhoods <- c("Camden", "Northeast", "Near North",
                    "Central", "University",
                    "Calhoun Isle", "Powderhorn", "Longfellow", "Southwest", 
                    "Nokomis", "Phillips")
  
stp_neighborhoods <- c("St Anthony Park", "Como", 
                   "North End", "Hamline-Midway",
                   "Macalester-Groveland", "Highland", 
                   "West Side Community Organization", "Summit Hill Association",
                   "Summit-University", "Thomas-Dale/Frogtown", 
                   "West 7th Federation/Fort Road", "CapitolRiver Council",
                   "Payne-Phalen", "The Greater East Side",
                   "Dayton's Bluff", "Eastview-Conway-Battle Creek-Highwood Hills",
                   "Union Park")
```

<!-- Define the inputs that you will use -->

```{r,echo=FALSE,message=FALSE,warning=FALSE}

selectInput("NBHDchoice",
              label = "Select Neighborhood To Display",
              choices = list("University", "Camden", "Northeast",
                             "Near North", "Central", "Calhoun Isle",
                             "Powderhorn", "Longfellow", "Southwest",
                             "Nokomis", "Phillips", "Como", "North End",
                             "Hamline-Midway", "Macalester-Groveland","Highland",
                             "West Side Community Organization", 
                             "Summit Hill Association", "Summit-University",
                             "Thomas-Dale/Frogtown", "West 7th Federation/Fort Road",
                             "Capital River Council","Payne-Phalen", 
                             "The Greater East Side", "Dayton's Bluff",
                             "Eastview-Conway-Battle Creek-Highwood Hills",
                             "Union Park"))

```



```{r,echo=FALSE,message=FALSE,warning=FALSE}

renderPlot({
  
  
   msp_data <- subset(NBHD_MPLS, CommName %in% input$NBHDchoice) %>% 
     spTransform(CRS("+init=epsg:4326"))
  
  
  station_map + geom_polygon(data = msp_data, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3)
  
})

```
















