---
title: "MAT213 Project #5"
author: "Bjorn Melin"
date: "4/23/2019"
runtime: shiny
output: html_document
---


```{r,echo=FALSE,message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(ggmap)
library(leaflet)
library(rgdal)
library(maps)
library(mapdata)
library(broom)
library(maptools)
library(leaflet.extras)
library(scales)
#library(plyr)
# When you use google to get place information, register your key.  
# (You need to be connected to the web.)
ggmap::register_google(key = "AIzaSyDwEoO3zb84PWYxp8_uK3z163Gkc4wLLKg")

# Reads in the trip history data from the 2017 season dataset
trip_hist_2017 <- read.csv(file = "Nice_ride_data_2017_season/Nice_ride_trip_history_2017_season.csv")

# Reads in the station data from the 2017 season dataset
station_locations_2017 <- read.csv(file = "Nice_ride_data_2017_season/Nice_Ride_2017_Station_Locations.csv")
```




```{r, echo=FALSE, message=FALSE}
# I need to create the map using the station_locations_2017 data
#glimpse(station_locations_2017)

# Makes a google map of the Minneapolis/St Paul area
msp_map <- get_map(location=c("Minneapolis/St Paul, Minnesota"),maptype = "roadmap",zoom=11)
#ggmap(msp_map)

# Creates a ggplot with points denoting the location of all bike stations
# in the Minneapolis area
station_plot <- ggplot() +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude)) +
  coord_fixed(ratio = 1.3)
#station_plot

#### Plot A ####
# Combines the map of Minneapolis generated and the plot of the bike stations
# in the Minneapolis area.  Used xlim and ylim to make the point more easy to
# differentiate.
station_map <- ggmap(msp_map) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75) +
  coord_fixed(ratio = 1.3, xlim = c(-93.4,-93.05), ylim = c(44.875,45.05)) +
  xlab(label = "Longitude") + 
  ylab(label = "Latitude") +
  ggtitle(label = "Nice Ride Bike Station Locations In MPLS/STP (2017)") +
  theme(axis.title = element_text(face = "bold", size = rel(1)),
        plot.title = element_text(size = rel(1.2), face = "bold", hjust = 0.5))
```



The app created for this project was constructed by using one of the maps for representing Nice Ride Bike Locations in project 4.  I imported a shapefile containing the neighborhood boundaries of Minneapolis from (http://opendata.minneapolismn.gov/datasets/communities) and a shapefile containing the neighborhood boundaries of Saint Paul from (https://information.stpaul.gov/City-Administration/District-Council-Shapefile-Map/dq4n-yj8b).  Then I created a new map which combined the Nice Ride map from project 4 with the neighborhood boundaries from the shapefiles.  The original map from prject 4 was modified so that in addition to showing points to represent all Nice Ride Station locations in the Minneapolis/St. Paul area, it would show borders on the map denoting the borders between neighborhoods in each city.  The app will include check boxes for each neighborhood which when selected, will display the neighborhoods boundary and the Nice Ride Stations in that neighborhood.


```{r, echo=FALSE, message=FALSE, warning=FALSE}
#### The map of all locations created in this markdown section ####
#### will be displayed initially before the user enters        ####
#### in which neighborhood they want shown on the map          ####

# Reads in the shapefile of the neighborhood boundaries in Minneapolis 
NBHD_MPLS <- readOGR(dsn = "Communities", verbose = FALSE)

# Displays the variable names of the shapefile
#names(NBHD_boundary)

# Reads in the shapefile of the neighborhood boundaries in STP
NBHD_STP <- readOGR(dsn = "STP_Neighborhoods", verbose = FALSE)

# Used to check what the variables represented in the STP shapefile
# as.data.frame(NBHD_STP)
# names(NBHD_STP)

# Uses ggplot to make a plot of Minneapolis 
# & Saint Paul neighborhood boundaries together.
MPLS_STP_plot <- ggplot() +
  geom_polygon(data = NBHD_MPLS, aes(x= long, y = lat, group = group), 
               color = 'blue',fill=NA) + coord_fixed(1.3) +
  geom_polygon(data = NBHD_STP, aes(x= long, y = lat, group = group), 
               color = 'blue',fill=NA) + coord_fixed(1.3) +
  ggtitle(label = "MPLS/STP Neighborhood Borders") +
  xlab(label = "Longitude") +
  ylab(label = "Latitude")
#MPLS_STP_plot

mpls_map <- get_map("Minneapolis/St Paul, Minnesota", maptype = "roadmap", zoom = 11)


# You should see that the coordinate project system (the +proj=) is utm. Fortnately we 
# can easily transform our data to the same system with the command spTransform:
NBHD_MPLS_google <- NBHD_MPLS %>% spTransform(CRS("+init=epsg:4326"))
NBHD_STP_google <- NBHD_STP %>% spTransform(CRS("+init=epsg:4326"))

# Combines the two plots together, showing the boundary data
all_NBHD_plot <- ggmap(mpls_map) + 
  geom_polygon(data = NBHD_MPLS_google, aes(x=long, y = lat, group = group),
               color = 'blue', fill = NA) + coord_fixed(1.3) +
  geom_polygon(data = NBHD_STP_google, aes(x= long, y = lat, group = group), 
               color = 'red',fill=NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75) +
  coord_fixed(ratio = 1.3, xlim = c(-93.35,-92.99), ylim = c(44.85,45.07)) +
  ggtitle(label = "Nice Ride Station Locations In MPLS/STP") +
  xlab(label = "Longitude") +
  ylab(label = "Latitude") +
  theme(axis.title = element_text(face = "bold", size = rel(1)),
        plot.title = element_text(size = rel(1.2), face = "bold", hjust = 0.5))
```



```{r, echo=FALSE,message=FALSE, warning=FALSE}
# Now I need to make it so that you can select to see a zoomed
# in map of each neighborhood which shows the stations in each neighborhood
#View(NBHD_MPLS$CommName)
#View(NBHD_STP$name2)

STP_list_NBHD <- data.frame(city = "STP",
  neighborhood = c("St Anthony Park", "Como", 
                   "North End", "Hamline-Midway",
                   "Macalester-Groveland", "Highland", 
                   "West Side Community Organization", "Summit Hill Association",
                   "Summit-University", "Thomas-Dale/Frogtown", 
                   "West 7th Federation/Fort Road", "CapitolRiver Council",
                   "Payne-Phalen", "The Greater East Side",
                   "Dayton's Bluff", "Eastview-Conway-Battle Creek-Highwood Hills",
                   "Union Park"))
#STP_list_NBHD

MPLS_list_NBHD <- data.frame(city = "MPLS",
  neighborhood = c("Camden", "Northeast", "Near North",
                    "Central", "University",
                    "Calhoun Isle", "Powderhorn", "Longfellow", "Southwest", 
                    "Nokomis", "Phillips"))
#MPLS_list_NBHD

all_neighborhoods <- rbind(STP_list_NBHD, MPLS_list_NBHD)
#View(all_neighborhoods)
```



```{r,echo=FALSE,message=FALSE,eval=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(shiny)  # This is needed
library(tidyverse)
library(tidyverse)
library(lubridate)
library(ggthemes)
library(plotly)
library(dygraphs)
library(shiny)
library(macleish)

# Define plot input names
plot_name <- "Nice Ride Bike Station Locations In Selected Neighborhood"
```


<!-- Define the inputs that you will use -->

```{r,echo=FALSE,message=FALSE,warning=FALSE}
selectInput("plotchoice",
            label = "Choose A Plot To Display",
            choices = "Plot 1",
            selected = "Plot 1")

    # Main panel for displaying outputs ----
    mainPanel(plotOutput(outputId = "stationplot"),
              position = "center")
```



```{r,echo=FALSE,message=FALSE,warning=FALSE}
datasetInput <- reactive({
  
    data <- switch(input$plotchoice,
                   "Plot 1" = all_NBHD_plot) 
})
  
  output$stationplot <- renderPlot({
    
    # Displays as output the time plot in which the user want to view
    plot(datasetInput()) 
    
    })

```














