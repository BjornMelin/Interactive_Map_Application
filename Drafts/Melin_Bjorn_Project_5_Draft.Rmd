---
title: "MAT213 Project #5"
author: "Bjorn Melin"
date: "4/23/2019"
runtime: shiny
output: html_document
---


```{r,echo=FALSE,message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(ggmap)
library(leaflet)
library(rgdal)
library(maps)
library(mapdata)
library(broom)
library(maptools)
library(leaflet.extras)
library(scales)
library(dplyr)
#library(plyr)
# When you use google to get place information, register your key.  
# (You need to be connected to the web.)
ggmap::register_google(key = "AIzaSyDwEoO3zb84PWYxp8_uK3z163Gkc4wLLKg")

# Reads in the trip history data from the 2017 season dataset
trip_hist_2017 <- read.csv(file = "Nice_ride_data_2017_season/Nice_ride_trip_history_2017_season.csv")

# Reads in the station data from the 2017 season dataset
station_locations_2017 <- read.csv(file = "Nice_ride_data_2017_season/Nice_Ride_2017_Station_Locations.csv")
```




```{r, echo=FALSE, message=FALSE}
# I need to create the map using the station_locations_2017 data
#glimpse(station_locations_2017)

# Makes a google map of the Minneapolis/St Paul area
msp_map <- get_map(location=c("Minneapolis/St Paul, Minnesota"),maptype = "roadmap",zoom=11)
#ggmap(msp_map)

# Creates a ggplot with points denoting the location of all bike stations
# in the Minneapolis area
station_plot <- ggplot() +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude)) +
  coord_fixed(ratio = 1.3)
#station_plot

#### Plot A ####
# Combines the map of Minneapolis generated and the plot of the bike stations
# in the Minneapolis area.  Used xlim and ylim to make the point more easy to
# differentiate.
station_map <- ggmap(msp_map) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75) +
  coord_fixed(ratio = 1.3, xlim = c(-93.4,-93.05), ylim = c(44.875,45.05)) +
  xlab(label = "Longitude") + 
  ylab(label = "Latitude") +
  ggtitle(label = "Nice Ride Bike Station Locations In MPLS/STP (2017)") +
  theme(axis.title = element_text(face = "bold", size = rel(1)),
        plot.title = element_text(size = rel(1.2), face = "bold", hjust = 0.5))
```



The app created for this project was constructed by using one of the maps for representing Nice Ride Bike Locations in project 4.  I imported a shapefile containing the neighborhood boundaries of Minneapolis from (http://opendata.minneapolismn.gov/datasets/communities) and a shapefile containing the neighborhood boundaries of Saint Paul from (https://information.stpaul.gov/City-Administration/District-Council-Shapefile-Map/dq4n-yj8b).  Then I created a new map which combined the Nice Ride map from project 4 with the neighborhood boundaries from the shapefiles.  The original map from prject 4 was modified so that in addition to showing points to represent all Nice Ride Station locations in the Minneapolis/St. Paul area, it would show borders on the map denoting the borders between neighborhoods in each city.  The app will include check boxes for each neighborhood which when selected, will display the neighborhoods boundary and the Nice Ride Stations in that neighborhood.


```{r, echo=FALSE, message=FALSE, warning=FALSE}
#### The map of all locations created in this markdown section ####
#### will be displayed initially before the user enters        ####
#### in which neighborhood they want shown on the map          ####

# Reads in the shapefile of the neighborhood boundaries in Minneapolis 
NBHD_MPLS <- readOGR(dsn = "Communities", verbose = FALSE)

# Displays the variable names of the shapefile
#names(NBHD_boundary)

# Reads in the shapefile of the neighborhood boundaries in STP
NBHD_STP <- readOGR(dsn = "STP_Neighborhoods", verbose = FALSE)

# Used to check what the variables represented in the STP shapefile
# as.data.frame(NBHD_STP)
# names(NBHD_STP)

# Uses ggplot to make a plot of Minneapolis 
# & Saint Paul neighborhood boundaries together.
MPLS_STP_plot <- ggplot() +
  geom_polygon(data = NBHD_MPLS, aes(x= long, y = lat, group = group), 
               color = 'blue',fill=NA) + coord_fixed(1.3) +
  geom_polygon(data = NBHD_STP, aes(x= long, y = lat, group = group), 
               color = 'blue',fill=NA) + coord_fixed(1.3) +
  ggtitle(label = "MPLS/STP Neighborhood Borders") +
  xlab(label = "Longitude") +
  ylab(label = "Latitude")
#MPLS_STP_plot

mpls_map <- get_map("Minneapolis/St Paul, Minnesota", maptype = "roadmap", zoom = 11)


# You should see that the coordinate project system (the +proj=) is utm. Fortnately we 
# can easily transform our data to the same system with the command spTransform:
NBHD_MPLS_google <- NBHD_MPLS %>% spTransform(CRS("+init=epsg:4326"))
NBHD_STP_google <- NBHD_STP %>% spTransform(CRS("+init=epsg:4326"))

# Combines the two plots together, showing the boundary data
all_NBHD_plot <- ggmap(mpls_map) + 
  geom_polygon(data = NBHD_MPLS_google, aes(x=long, y = lat, group = group),
               color = 'blue', fill = NA) + coord_fixed(1.3) +
  geom_polygon(data = NBHD_STP_google, aes(x= long, y = lat, group = group), 
               color = 'red',fill=NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75) +
  coord_fixed(ratio = 1.3, xlim = c(-93.35,-92.99), ylim = c(44.85,45.07)) +
  ggtitle(label = "Nice Ride Station Locations In MPLS/STP") +
  xlab(label = "Longitude") +
  ylab(label = "Latitude") +
  theme(axis.title = element_text(face = "bold", size = rel(1)),
        plot.title = element_text(size = rel(1.2), face = "bold", hjust = 0.5))
```



```{r, echo=FALSE,message=FALSE, warning=FALSE}
mpls_neighborhoods <- c("Camden", "Northeast", "Near North",
                    "Central", "University",
                    "Calhoun Isle", "Powderhorn", "Longfellow", "Southwest", 
                    "Nokomis", "Phillips")
  
stp_neighborhoods <- c("St Anthony Park", "Como", 
                   "North End", "Hamline-Midway",
                   "Macalester-Groveland", "Highland", 
                   "West Side Community Organization", "Summit Hill Association",
                   "Summit-University", "Thomas-Dale/Frogtown", 
                   "West 7th Federation/Fort Road", "CapitolRiver Council",
                   "Payne-Phalen", "The Greater East Side",
                   "Dayton's Bluff", "Eastview-Conway-Battle Creek-Highwood Hills",
                   "Union Park")
```

```{r, echo=FALSE}
###### KEY NOTE: The only reason I did this is because no matter what 
###### I did I could not get my output app to work how I wanted when 
###### creating the plots inside of the app.  After hours of messing around
###### with it I decided to go this route.  Although it is a ton of code that 
###### could be avoided if I could have figured it out, it still works how
###### I wanted it to.  Really had to get studying for other finals too.

# Creates subsets of all Minneapolis neighborhoods
University <- subset(NBHD_MPLS, CommName == "University")
Camden <- subset(NBHD_MPLS, CommName == "Camden")
Northeast <- subset(NBHD_MPLS, CommName == "Northeast")
NearNorth <- subset(NBHD_MPLS, CommName == "Near North")
Central <- subset(NBHD_MPLS, CommName == "Central")
CalhounIsle <- subset(NBHD_MPLS, CommName == "Calhoun Isle")
Powderhorn <- subset(NBHD_MPLS, CommName == "Powderhorn")
Longfellow <- subset(NBHD_MPLS, CommName == "Longfellow")
Southwest <- subset(NBHD_MPLS, CommName == "Southwest")
Nokomis <- subset(NBHD_MPLS, CommName == "Nokomis")
Phillips <- subset(NBHD_MPLS, CommName == "Phillips")

# Makes maps with only the specific MPLS neighborhood inputted
# outlined.  Displaying all Nice Ride Stations still
University_map <- ggmap(mpls_map) +
  geom_polygon(data = University, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

Camden_map <- ggmap(mpls_map) +
  geom_polygon(data = Camden, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

Northeast_map <- ggmap(mpls_map) +
  geom_polygon(data = Northeast, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

NearNorth_map <- ggmap(mpls_map) +
  geom_polygon(data = University, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

Central_map <- ggmap(mpls_map) +
  geom_polygon(data = Central, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

CalhounIsle_map <- ggmap(mpls_map) +
  geom_polygon(data = CalhounIsle, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

Powederhorn_map <- ggmap(mpls_map) +
  geom_polygon(data = Powderhorn, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

Longfellow_map <- ggmap(mpls_map) +
  geom_polygon(data = Longfellow, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

Southwest_map <- ggmap(mpls_map) +
  geom_polygon(data = Southwest, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

Nokomis_map <- ggmap(mpls_map) +
  geom_polygon(data = Nokomis, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

Phillips_map <- ggmap(mpls_map) +
  geom_polygon(data = Phillips, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)


# Creates subsets of all St. Paul neighborhoods
# Also makes maps with only the specific MPLS neighborhood inputted
# outlined.  Displaying all Nice Ride Stations still
StAnthonyPark <- subset(NBHD_MPLS, CommName == "St Anthony Park")
StAnthonyPark_map <- ggmap(mpls_map) +
  geom_polygon(data = StAnthonyPark, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

Como <- subset(NBHD_MPLS, CommName == "Como")
Como_map <- ggmap(mpls_map) +
  geom_polygon(data = Como, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

NorthEnd <- subset(NBHD_MPLS, CommName == "North End")
NorthEnd_map <- ggmap(mpls_map) +
  geom_polygon(data = NorthEnd, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

HamlineMidway <- subset(NBHD_MPLS, CommName == "Hamline-Midway")
HamlineMidwayk_map <- ggmap(mpls_map) +
  geom_polygon(data = HamlineMidway, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

MacalesterGroveland <- subset(NBHD_MPLS, CommName == "Macalester-Groveland")
MacalesterGroveland_map <- ggmap(mpls_map) +
  geom_polygon(data = MacalesterGroveland, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

Highland <- subset(NBHD_MPLS, CommName == "Highland")
Highland_map <- ggmap(mpls_map) +
  geom_polygon(data = Highland, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

WestSideComm <- subset(NBHD_MPLS, CommName == "West Side Community Organization")
WestSideComm_map <- ggmap(mpls_map) +
  geom_polygon(data = WestSideComm, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

SummitHillA <- subset(NBHD_MPLS, CommName == "Summit Hill Association")
SummitHillA_map <- ggmap(mpls_map) +
  geom_polygon(data = SummitHillA, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

SummitUniversity <- subset(NBHD_MPLS, CommName == "Summit-University")
SummitUniversity_map <- ggmap(mpls_map) +
  geom_polygon(data = SummitUniversity, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

ThomasDaleF <- subset(NBHD_MPLS, CommName == "Thomas-Dale/Frogtown")
ThomasDaleF_map <- ggmap(mpls_map) +
  geom_polygon(data = ThomasDaleF, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

West7thFFR <- subset(NBHD_MPLS, CommName == "West 7th Federation/Fort Road")
West7thFFR_map <- ggmap(mpls_map) +
  geom_polygon(data = West7thFFR, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

CapitolRC <- subset(NBHD_MPLS, CommName == "CapitolRiver Council")
CapitolRC_map <- ggmap(mpls_map) +
  geom_polygon(data = CapitolRC, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

PaynePhalen <- subset(NBHD_MPLS, CommName == "Payne-Phalen")
PaynePhalen_map <- ggmap(mpls_map) +
  geom_polygon(data = PaynePhalen, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

TheGreaterEastSide <- subset(NBHD_MPLS, CommName == "The Greater East Side")
TheGreaterEeatSide_map <- ggmap(mpls_map) +
  geom_polygon(data = TheGreaterEastSide, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

DaytonsBluff <- subset(NBHD_MPLS, CommName == "Dayton's Bluff")
DaytonsBluff_map <- ggmap(mpls_map) +
  geom_polygon(data = DaytonsBluff, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

EastviewConwayBattleCreekHH <- subset(NBHD_MPLS, 
                        CommName == "Eastview-Conway-Battle Creek-Highwood Hills")
EastviewConwayBattleCreekHH_map <- ggmap(mpls_map) +
  geom_polygon(data = EastviewConwayBattleCreekHH, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)

UnionPark <- subset(NBHD_MPLS, CommName == "Union Park")
UnionPark_map <- ggmap(mpls_map) +
  geom_polygon(data = UnionPark, aes(x = long, y = lat, group = group),
               color = "blue", fill = NA) + coord_fixed(1.3) +
  geom_point(data = station_locations_2017, aes(x= Longitude, y = Latitude), 
             size = 1, alpha = 0.75)
```

```{r,echo=FALSE,message=FALSE,eval=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(shiny)  # This is needed
library(tidyverse)
library(tidyverse)
library(lubridate)
library(ggthemes)
library(plotly)
library(dygraphs)
library(shiny)
library(macleish)

# Define plot input names
plot_name <- "Nice Ride Bike Station Locations In Selected Neighborhood"
```


<!-- Define the inputs that you will use -->

```{r,echo=FALSE,message=FALSE,warning=FALSE}
selectInput("citychoice",
            label = "Select City Of Neighborhood To Display",
            choices = list(NBHD_MPLS, NBHD_STP))

selectInput("NBHDchoice",
              label = "Select Neighborhood To Display",
              choices = list("University", "Camden", "Northeast",
                             "Near North", "Central", "Calhoun Isle",
                             "Powderhorn", "Longfellow", "Southwest",
                             "Nokomis", "Phillips", "Como", "North End",
                             "Hamline-Midway", "Macalester-Groveland","Highland",
                             "West Side Community Organization", 
                             "Summit Hill Association", "Summit-University",
                             "Thomas-Dale/Frogtown", "West 7th Federation/Fort Road",
                             "Capital River Council","Payne-Phalen", 
                             "The Greater East Side", "Dayton's Bluff",
                             "Eastview-Conway-Battle Creek-Highwood Hills",
                             "Union Park"))

# Main panel for displaying outputs ----
mainPanel(plotOutput(outputId = "NBHDplot", width = "100%"),
              position = "center")
```



```{r,echo=FALSE,message=FALSE,warning=FALSE}
datasetInput <- reactive({
   data <- switch(input$NBHDchoice,
                      "University" = University_map,
                      "Camden" = Camden_map,
                      "Northeast" = Northeast_map,
                      "Near North" = NearNorth_map,
                      "Central" = Central_map,
                      "Calhoun Isle" = CalhounIsle_map,
                      "Powderhorn" = Powederhorn_map,
                      "Longfellow" = Longfellow_map,
                      "Southwest" = Southwest_map,
                      "Nokomis" = Nokomis_map,
                      "Phillips" = Phillips_map,
                      "Como" = Como_map,
                      "North End" = NearNorth_map,
                      "Hamline-Midway" = HamlineMidwayk_map,
                      "Macalester-Groveland" = MacalesterGroveland_map,
                      "Highland" = Highland_map,
                      "West Side Community Organization" = WestSideComm_map,
                      "Summit Hill Association" = SummitHillA_map,
                      "Summit-University" = SummitUniversity_map,
                      "Thomas-Dale/Frogtown" = ThomasDaleF_map,
                      "West 7th Federation/Fort Road" = West7thFFR_map,
                      "Capital River Council" = CapitolRC_map,
                      "Payne-Phalen" = PaynePhalen_map,
                      "The Greater East Side" = TheGreaterEeatSide_map,
                      "Dayton's Bluff" = DaytonsBluff_map,
                      "Eastview-Conway-Battle Creek-Highwood Hills" =
                                        EastviewConwayBattleCreekHH_map,
                      "UnionPark" = UnionPark_map)
 
})

output$NBHDplot <- renderPlot({
  
  (datasetInput())
  
})

```
















